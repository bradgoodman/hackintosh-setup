---
- name: Import flutter vars
  include_vars: /Users/brad/Git/hackintosh-setup/playbooks/vars/flutter.vars

- name: Get Flutter Version
  command: flutter --version
  register: flutter_version

- name: Check for Flutter SDK
  stat:
    path: "~/Downloads/flutter_macos_v{{ flutter_target_version }}-beta.zip" 
  register: flutter_sdk

- name: Download Flutter SDK
  get_url:
    url: "https://storage.googleapis.com/flutter_infra/releases/beta/macos/flutter_macos_v{{ flutter_target_version }}-beta.zip"
    dest: ~/Downloads
  when: flutter_sdk.stat.exists == False and flutter_version.stdout_lines[0].split()[1] != flutter_target_version 
  register: flutter_update 

- name: Extract Flutter
  unarchive:
    src: "~/Downloads/flutter_macos_v{{ flutter_target_version }}-beta.zip"
    dest: ~/Git
  when: flutter_update.changed and flutter_version.stdout_lines[0].split()[1] != flutter_target_version 

- name: Add Flutter to Path
  lineinfile:
    path: /etc/paths
    line: /Users/brad/Git/flutter/bin
  become: yes

- name: Update Flutter
  command: flutter upgrade

- name: Delete downloaded Flutter SDK
  file:
    path: "~/Downloads/flutter_macos_v{{ flutter_target_version }}-beta.zip"
    state: absent
...